
test_that("plot_module_ui", {
  expect_type(plot_module_ui("id", "Title"), "list")
})

test_that("plot_module_server_nf1", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(nf_data),
      "config" = get_nf_summary_snapshot_config() %>%
        purrr::pluck("initiative_activity") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_initiative_activity_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c("Species", "Initiative", "Access Type", "Count"))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

test_that("plot_module_server_nf2", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(nf_data),
      "config" = get_nf_publication_status_config() %>%
        purrr::pluck("publication_status") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_publication_status_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c("Year", "Study Name", "Count"))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

test_that("plot_module_server_nf3", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(nf_ntap_data),
      "config" = get_nf_publication_status_config() %>%
        purrr::pluck("publication_status") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_publication_status_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c("Year", "Study Name", "Count"))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

test_that("plot_module_server_csbc1", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(csbc_data),
      "config" = get_csbc_summary_snapshot_config() %>%
        purrr::pluck("initiative_activity") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_initiative_activity_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c('Year', 'Consortium', 'Access Type', 'Count'))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

test_that("plot_module_server_csbc2", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(csbc_data),
      "config" = get_csbc_publication_status_config() %>%
        purrr::pluck("publication_disease") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_publication_disease_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c('Year', 'Tissue', 'Count'))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

test_that("plot_module_server_csbc3", {
  shiny::testServer(
    plot_module_server,
    args = list(
      "data" = shiny::reactiveVal(csbc_data),
      "config" = get_csbc_summary_snapshot_config() %>%
        purrr::pluck("resources_generated") %>%
        shiny::reactiveVal(),
      "plot_func" = shiny::reactiveVal("create_resources_generated_plot")
    ),
    {
      expect_true(tibble::is_tibble(plot_data()))
      expect_named(plot_data(), c('Year', 'Grant Name', 'Theme', 'Count'))
      expect_type(output$plot, "character")
      expect_type(output$download_tbl, "character")
    }
  )
})

